#include "chip8.h"

void init(c8 *chip8){
	chip8.PC = 0x200;	//PC at 0x200 (ROM Starting point)
	chip8.SP = 0;
	chip8.IR = 0;
	chip8.delayTimer = 0;
	chip8.soundTimer = 0;
	
	//clear stack, memory and registers
	memset(chip8.stack, 0, sizeof(chip8.stack));
	memset(chip8.memory, 0, sizeof(chip8.memory));
	memset(chip8.R, 0, sizeof(chip8.R));

	const unsigned char fontset[80] = {
		0xF0, 0x90, 0x90, 0x90, 0xF0,		// 0
		0x20, 0x60, 0x20, 0x20, 0x70,		// 1
		0xF0, 0x10, 0xF0, 0x80, 0xF0,		// 2
		0xF0, 0x10, 0xF0, 0x10, 0xF0,		// 3
		0x90, 0x90, 0xF0, 0x10, 0x10,		// 4
		0xF0, 0x80, 0xF0, 0x10, 0xF0,		// 5
		0xF0, 0x80, 0xF0, 0x90, 0xF0,		// 6
		0xF0, 0x10, 0x20, 0x40, 0x40,		// 7
		0xF0, 0x90, 0xF0, 0x90, 0xF0,		// 8
		0xF0, 0x90, 0xF0, 0x10, 0xF0,		// 9
		0xF0, 0x90, 0xF0, 0x90, 0x90,		// A
		0xE0, 0x90, 0xE0, 0x90, 0xE0,		// B
		0xF0, 0x80, 0x80, 0x80, 0xF0,		// C
		0xE0, 0x90, 0x90, 0x90, 0xE0,		// D
		0xF0, 0x80, 0xF0, 0x80, 0xF0,		// E
		0xF0, 0x80, 0xF0, 0x80, 0x80		// F
	};
	memcpy(chip8.memory, fontset, sizeof(fontset));
}

void load_rom(const char* rom, c8 *chip8){
	FILE *fp = fopen(rom, "rb");
	if(fp == NULL){
		printf("Invalid ROM: %s\n", rom);
	}else{
		//load the ROM contents to memory+0x200		
		fread(chip8.memory+0x200, sizeof(char), sizeof(chip8.memory)-0x200, fp);

		fclose(fp);
	}
}











